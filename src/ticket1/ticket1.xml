<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ticket1">
    
    <typeAlias alias="ticket1VO" type="ticket1.Ticket1VO"/>
    
    <!-- 공통조건 -->
	<sql id="searchSql">		
		<!-- WHERE 절 검색 -->
		<dynamic prepend="where">
			<isNotEqual property="sval" compareValue="" prepend="and">
				<isEqual property="stype" compareValue="all" prepend="and">
					( (member.name like '%$sval$%' ) or (movie.title like '%$sval$%' ) ) 					
				</isEqual>
			</isNotEqual>
			<isNotEqual property="sdate" compareValue="">
				<isNotEqual property="edate" compareValue="" prepend="and">
					$dateType$ between '$sdate$' and '$edate$'
				</isNotEqual>
			</isNotEqual>
			<isNotEqual property="sres_state" compareValue="0" prepend="and">
				res_state = #sres_state#
			</isNotEqual>
			<isNotEqual property="spay_state" compareValue="0" prepend="and">
				pay_state = #spay_state#
			</isNotEqual>
			<isNotEqual property="spay" compareValue="0" prepend="and">
				pay = #spay#
			</isNotEqual>
		</dynamic>
	</sql>
	<select id="count" parameterClass="ticket1VO" resultClass="Integer">
        select count(*) from ticket1
        <include refid="searchSql" />	
    </select>
	
    <select id="list" parameterClass="ticket1VO" resultClass="ticket1VO">
        select *  <!-- ,
        (select title from movie where movie.no=tiket1.movie_fk) as title,
        (select format from movie where movie.no=tiket1.movie_fk) as format
         -->
        from ticket1
        <include refid="searchSql" />
		ORDER BY no DESC LIMIT $startPageNo$, $pageRows$	
    </select>
     
</sqlMap>