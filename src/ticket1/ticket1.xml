<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ticket1">
    
    <typeAlias alias="ticket1VO" type="ticket1.Ticket1VO"/>
    
    <!-- 공통조건 -->
	<sql id="searchSql">		
		<!-- WHERE 절 검색 -->
		<dynamic prepend="where">
			<isNotEqual property="sval" compareValue="" prepend="and">
				<isEqual property="stype" compareValue="all" prepend="and">
					( (price like '%$sval$%' ) or (res_date like '%$sval$%' ) ) 					
				</isEqual>
				<isNotEqual property="stype" compareValue="all" prepend="and">
					($stype$ like '%$sval$%' )
				</isNotEqual>
			</isNotEqual>
		</dynamic>
	</sql>
	
	<select id="count" parameterClass="ticket1VO" resultClass="Integer">
        select count(*) from ticket1
        <include refid="searchSql" />	
    </select>
	
    <select id="list" parameterClass="ticket1VO" resultClass="ticket1VO">
        select * <!-- ,
        (select title from movie where movie.no=tiket1.movie_fk) as title,
        (select format from movie where movie.no=tiket1.movie_fk) as format
         -->
        from ticket1
        <include refid="searchSql" />
		ORDER BY no DESC LIMIT $startPageNo$, $pageRows$	
    </select>
    
    <select id="date" resultClass="ticket1VO">
    <![CDATA[
    	select today, name as yoil from calendar
    	where today >= substring(now(), 1, 10)
    	and today < date_add(substring(now(),1,10), interval 14 day)
   	]]>    
    </select>
     
    <select id="aranMovieDate" parameterClass="Integer" resultClass="ticket1VO">
 		select today 
		from Calendar as c, movie as m
		where m.no = #no#
		 <![CDATA[
		and c.today >= m.releaseDate
		]]>
		 <![CDATA[
		and c.today <= m.endDate
		]]>
		 <![CDATA[
		and c.today >= substring(now(),1,10) 
		]]>  
		 <![CDATA[
		and c.today < date_add(substring(now(),1,10), interval 14 day)
		]]>
	
		ORDER BY c.today ASC 
     </select>
</sqlMap>